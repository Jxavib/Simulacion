---
title: "Practica 2"
author: ",Beltran Henry, Burbano Joel, Guaman Ronny"
date: "24/6/2021"
output: html_document
---

### Ejercicios de fin de práctica

**4. Escribir el codigo necesario para generar, por el método de inversión, una muestra de $n$ observaciones de una distribución Cauchy.**

```{r include=T}
# Distribuci?n de Cauchy por inversi?n

rcauchyn <- function(n = 1000) {
# Simulaci?n n valores de distribuci?n de Cauchy
    return(tan(pi*runif(n)))
}
```


**a) Generar una muestra de $10^4$ observaciones y obtener el tiempo de CPU.**

```{r echo=F}
set.seed(1)
nsim <- 10^4
system.time(x <- rcauchyn(nsim))
```

**b) Representar el histograma (limitar el rango, e.g. ``xlim=c(-10,10)``) y compararlo con densidad teórica.**

```{r echo=F}
hist(x, breaks = "FD", freq = FALSE, xlim=c(-10,10))
curve(dcauchy(x), add = TRUE)
```

**c) Obtener conclusiones sobre la existencia de una media teórica a partir de la media muestral aproximada por simulación (estudiar la convergencia de la media muestral ). Suponiendo que el vector x contiene las simulaciones, estudiar la convergencia de la media muestralmediante el gráfico:**
``plot(1:nsim,cumsum(x)/(1:nsim), type="1", ylab="Media muestral",xlab="N° de simulaciones")``

```{r echo=F}
plot(1:nsim, cumsum(x)/(1:nsim), type="l", ylab="Media muestral", xlab="N° de simulaciones")
```



```{r include=FALSE}
ddcauchy <- function(x, pi){
# Densidad Cauchy
  1/(pi*(1-x^2))
}

rdcauchy <- function(pi){
# Simulaci?n por inversi?n
# Doble exponencial
  U <- runif(1)
  if (U<0.5) {
    return(tan(pi*(U-0.5)))
  } else {
    return(tan(pi*U))
  }
}

rdcauchyn <- function(n = 1000, pi) {
# Simulaci?n n valores de doble exponencial
    x <- numeric(n)
    for(i in 1:n) x[i]<-rdcauchy(pi)
    return(x)
}

```

```{r include=FALSE}
set.seed(54321)
system.time(x <- rdcauchyn(10^4, pi))
```

**5. Eltiempo de respuesta (en centésimas de segundo) de un servidor de bases de datos en una variable con función de densidad:**
$$f(x)=xe^{-x}\quad \text{si }~x\geq0$$

**Escribir el código necesario para generar,por el método de aceptación rechazo, una muestra de $n$ observaciones de esta distribucion empleando como densidad auxiliar una exponencial:**
$$g(x)=\lambda e^{-\lambda x} \quad \text{si }~ x\geq 0$$
```{r include=F}
dtiempo <- function(x) ifelse(x > 0, x * exp(-x), 0)
curve(dtiempo, 0, 10)

lambda.opt <- 0.5
c.opt <- 4/exp(1)

rtiempoAR <- function() {
# Simulaci?n por aceptaci?n-rechazo
# dtiempo a partir de exponencial
  while (TRUE) {
    U <- runif(1)
    X <- rexp(1, lambda.opt)
    ngen <<- ngen + 1 # Comentar esta l?nea para uso normal
    if (c.opt * U * dexp(X, lambda.opt) <= dtiempo(X)) return(X)
  }
}

rtiempoARn <- function(n=1000) {
# Simulaci?n n valores dtiempo
    x <- numeric(n)
    ngen <<- 0 # Comentar esta l?nea para uso normal
    for(i in 1:n) x[i]<-rtiempoAR()
    return(x)
}

```

```{r echo=F}
# Grafico
curve(c.opt * dexp(x, lambda.opt), ylab = "c*g(x)", xlim=c(0, 10), lty = 2)
curve(dtiempo(x), add = TRUE)
```



**a) Aproximar numéricamente el parámetro óptimo $(\lambda_{opt}<1)$ y la cota óptima $(c_{opt})$ de la densidad auxiliar y compararlos con los valores teóricos: $\lambda_{opt}=1/2 \quad \text{y}\quad c_{opt}=4/e$**


```{r echo=F}
# Obtenci?n de un valor c ?ptimo aproximado
# NOTA: a partir del gr?fico del encabezado se deduce que en x=+-2 se obtiene el m?ximo
optimize(f=function(x){dtiempo(x)/dexp(x, lambda.opt)}, maximum=TRUE, interval=c(1,3))$objective
# Valor ?ptimo real
c.opt


# Obtenci?n de valores c y lambda ?ptimos aproximados
fopt <- function(lambda) {
# Obtiene c fijado lambda
  optimize(f=function(x){dtiempo(x)/dexp(x,lambda)}, maximum=TRUE, interval=c(1,3))$objective
}

# Encontar lambda que minimiza
optimize(f = function(x){fopt(x)}, interval = c(0.1,1))

```

**b) Generar una muestra de $1000$ observaciones de la distribución de interés tomando como semilla inicial los cuatro primeros digitos del DNI. obtener el tiempo de CPU que tarda en generar la secuencia y calcular el número medio de generaciones de la distribución auxiliar.**

```{r echo=F}
set.seed(54321)
nsim <- 10^4

ngen <- 0
system.time(x <- rtiempoARn(nsim))
# N? generaciones
{
cat("\nN? de generaciones = ", ngen)
cat("\nN? medio de generaciones = ", ngen/nsim)
cat("\nProporci?n de rechazos = ", 1-nsim/ngen, "\n")
}
```

**c) Representar el histograma y compararlo con la densidad teórica.**

```{r echo=F}
hist(x, breaks="FD", freq=FALSE)
curve(dtiempo(x), add=TRUE)
```

